/*!
 * multi-pass - version 0.0.1 
 * A simple javascript multivariate testing framework for use with Google Analytics
 *
 * OrangeGames
 * Build at 25-03-2016
 * Released under MIT License 
 */

var Quartz;!function(a){var b=function(){function b(a){this.namespace="",this.setNamespace(a)}return Object.defineProperty(b.prototype,"length",{get:function(){var b=Object.keys(localStorage);return a.Storage.nameSpaceKeyFilter(b,this.namespace).length},enumerable:!0,configurable:!0}),b.prototype.getItem=function(a){return localStorage.getItem(this.namespace+a)},b.prototype.setItem=function(a,b){localStorage.setItem(this.namespace+a,b)},b.prototype.deleteItem=function(a){localStorage.removeItem(this.namespace+a)},b.prototype.empty=function(){for(var b=Object.keys(localStorage),c=a.Storage.nameSpaceKeyFilter(b,this.namespace),d=0;d<c.length;d++)localStorage.removeItem(c[d])},b.prototype.setNamespace=function(a){a&&(this.namespace=a+":")},b}();a.LocalStorage=b}(Quartz||(Quartz={}));var Quartz;!function(a){var b=function(){function b(){this.store=null;try{"object"==typeof localStorage?(localStorage.setItem("testingLocalStorage","foo"),localStorage.removeItem("testingLocalStorage"),this.store=new a.LocalStorage("Quartz")):this.store=new a.CookieStorage("Quartz")}catch(b){this.store=new a.CookieStorage("Quartz")}return this}return b.getInstance=function(){return null===a.Storage.instance&&(a.Storage.instance=new a.Storage),a.Storage.instance},b.nameSpaceKeyFilter=function(a,b){return a.filter(function(a){return a.substring(0,b.length)===b})},b.prototype.setNamespace=function(a){if(null===this.store)throw new Error("No storage available, unable to set namespace: "+a);return this.store.setNamespace(a),this},b.prototype.get=function(a){if(null===this.store)throw new Error("No storage available, unable to get key: "+a);return this.store.getItem(a)},b.prototype.set=function(a,b){if(null===this.store)throw new Error("No storage available, unable to set key: "+a);return this.store.setItem(a,b),this},b.instance=null,b}();a.Storage=b}(Quartz||(Quartz={}));var Quartz;!function(a){var b=function(){function a(a){this.keys=[],this.namespace="",this.setNamespace(a)}return Object.defineProperty(a.prototype,"length",{get:function(){return null!==this.getNameSpaceMatches()?this.getNameSpaceMatches().length:0},enumerable:!0,configurable:!0}),a.prototype.getItem=function(a){return this.getCookiesForNameSpace()[a]||null},a.prototype.setItem=function(a,b){document.cookie=encodeURIComponent(this.namespace+a)+"="+encodeURIComponent(b)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/"},a.prototype.deleteItem=function(a){document.cookie=encodeURIComponent(this.namespace+a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"},a.prototype.setNamespace=function(a){a&&(this.namespace=a+":",this.reg=new RegExp("^"+this.namespace+"[a-zA-Z0-9]*","g"))},a.prototype.empty=function(){var a=this.getCookiesForNameSpace();for(var b in a)this.deleteItem(b)},a.prototype.getNameSpaceMatches=function(){var a=this,b=decodeURIComponent(document.cookie).split(" ");return b.filter(function(b){return null!==b.match(a.reg)?b.match(a.reg).length>0:!1})},a.prototype.getCookiesForNameSpace=function(){var a=this,b={};return this.getNameSpaceMatches().forEach(function(c){var d=c.replace(a.namespace,"").split("=");b[d[0]]=d[1]}),b},a}();a.CookieStorage=b}(Quartz||(Quartz={}));var MultiPass;!function(a){var b;!function(b){var c=function(){function b(){this.storage=Quartz.Storage.getInstance(),this.queue=[];var a=this.storage.get("queue");if(""!==a)try{this.queue=JSON.parse(a)}catch(b){console.warn("Unable to parse queue data, initialising with empty queue")}}return b.prototype.removeUuid=function(a){for(var b=this.queue.length;b>=0;b--)this.queue[b].hasOwnProperty("uuid")&&this.queue[b].uuid===a&&this.queue.splice(b);return this.storage.set("queue",JSON.stringify(this.queue))},b.prototype.flushQueue=function(){for(var a=this,b=[],c=0,d=this.queue.length;d>c;c++){var e=this.queue[c];b.push(ga("send","event",e.category,e.action,e.label,{hitCallback:function(){a.removeUuid(e.uuid)},nonInteraction:1}))}return b},b.prototype.track=function(b,c,d){this.queue.push({uuid:a.Utils.generateUuid(),category:b,action:c,label:d}),this.storage.set("queue",JSON.stringify(this.queue)),this.flushQueue()},b.prototype.start=function(a,b){return this.track("Experiment: "+a,b,"Visitors")},b.prototype.complete=function(a,b,c){return this.track(a,b,c)},b}();b.GoogleAnalytics=c}(b=a.Adapters||(a.Adapters={}))}(MultiPass||(MultiPass={}));var MultiPass;!function(a){var b=a.Adapters.GoogleAnalytics;Quartz.Storage.getInstance().setNamespace("multi-pass");var c=function(){function c(a){this.name=null,this.variants={},this.sample=1,this.storage=Quartz.Storage.getInstance(),this.tracker=new b,this.name=a.name,this.variants=a.variants,this.applyVariant()}return c.prototype.addGoal=function(b){return new a.Goal(this,b)},c.prototype.completeGoal=function(a,b){if(void 0===b&&(b=!0),!b||!this.storage.get(this.name+":"+a)){var c=this.storage.get(this.name+":variant");if(c)return b&&this.storage.set(this.name+":"+a,!0),this.tracker.complete(this.name,c,a)}},c.prototype.applyVariant=function(){var a=this.storage.get(this.name+":variant");if(console.log(this.inSample()),this.inSample()){null===a&&(a=this.chooseVariant(),console.log(a),this.tracker.start(this.name,a));var b;return null!=(b=this.variants[a])&&b.activate(this),console.log(b),this.storage.set(this.name+":variant",a),a}},c.prototype.chooseVariant=function(){var a=Object.keys(this.variants),b=1/a.length,c=Math.floor(Math.random()/b);console.log(a);var d=a[c];return d},c.prototype.inSample=function(){var a=this.storage.get(this.name+":isIn");if(null!==a)return"true"===a;var b=Math.random()<=this.sample;return this.storage.set(this.name+":isIn",b),b},c}();a.Experiment=c}(MultiPass||(MultiPass={}));var MultiPass;!function(a){var b=function(){function a(a,b,c){void 0===c&&(c=!0),this.unique=!0,this.experiment=a,this.name=b,this.unique=c}return a.prototype.complete=function(){this.experiment.completeGoal(this.name,this.unique)},a}();a.Goal=b}(MultiPass||(MultiPass={}));var MultiPass;!function(a){var b=function(){function a(){}return a.generateUuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},a}();a.Utils=b}(MultiPass||(MultiPass={}));